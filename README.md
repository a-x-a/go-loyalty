# Накопительная система лояльности "Гофермарт"

Система представляет собой HTTP API реализующей следующую бизнес-логику:

- регистрация, аутентификация и авторизация пользователей;
- приём номеров заказов от зарегистрированных пользователей;
- учёт и ведение списка переданных номеров заказов зарегистрированного пользователя;
- учёт и ведение накопительного счёта зарегистрированного пользователя;
- проверка принятых номеров заказов через систему расчёта баллов лояльности;
- начисление за каждый подходящий номер заказа положенного вознаграждения на счёт лояльности пользователя.

![Общая архитектура системы](./png/go-loyalty-%D0%9E%D0%B1%D1%89%D0%B0%D1%8F%20%D0%B0%D1%80%D1%85%D0%B8%D1%82%D0%B5%D0%BA%D1%82%D1%83%D1%80%D0%B0%20%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B.png "Общая архитектура системы")

## Абстрактная схема взаимодействия с системой

Ниже представлена абстрактная бизнес-логика взаимодействия пользователя с системой:

1.  Пользователь регистрируется в системе лояльности "Гофермарт".
2.  Пользователь совершает покупку в интернет-магазине "Гофермарт".
3.  Заказ попадает в систему расчёта баллов лояльности.
4.  Пользователь передаёт номер совершённого заказа в систему лояльности.
5.  Система связывает номер заказа с пользователем и сверяет номер с системой расчёта баллов лояльности.
6.  При наличии положительного расчёта баллов лояльности производится начисление баллов лояльности на счёт пользователя.
7.  Пользователь списывает доступные баллы лояльности для частичной или полной оплаты последующих заказов в интернет-магазине "Гофермарт".

Примечания:

- пункт 2 представлен как гипотетический и не реализован в данной решении;
- пункт 3 реализован в системе расчёта баллов лояльности и не требует реализации в данном решении.

![Схема взаимодействия](./png/go-loyalty-%D0%A1%D1%85%D0%B5%D0%BC%D0%B0%20%D0%B2%D0%B7%D0%B0%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5%D0%B9%D1%81%D1%82%D0%B2%D0%B8%D1%8F.png "Схема взаимодействия")

## Система расчёта баллов лояльности

Система расчёта баллов лояльности является внешним сервисом в доверенном контуре. Он работает по принципу чёрного ящика и недоступен для инспекции внешними клиентами. Система рассчитывает положенные баллы лояльности за совершённый заказ по сложным алгоритмам, которые могут меняться в любой момент времени.

Внешнему потребителю доступна только информация о количестве положенных за конкретный заказ баллов лояльности. Причины наличия или отсутствия начислений внешнему потребителю неизвестны.

## Сводное HTTP API

Накопительная система лояльности "Гофермарт" предоставляет следующие HTTP-хендлеры:

- `POST /api/user/register` — регистрация пользователя;
- `POST /api/user/login` — аутентификация пользователя;
- `POST /api/user/orders` — загрузка пользователем номера заказа для расчёта;
- `GET /api/user/orders` — получение списка загруженных пользователем номеров заказов, статусов их обработки и информации о начислениях;
- `GET /api/user/balance` — получение текущего баланса счёта баллов лояльности пользователя;
- `POST /api/user/balance/withdraw` — запрос на списание баллов с накопительного счёта в счёт оплаты нового заказа;
- `GET /api/user/withdrawals` — получение информации о выводе средств с накопительного счёта пользователем.

## Общие требования и ограничения

- в качестве хранилища данных используется PostgreSQL.

![Инфогическая модель](./png/go-loyalty-%D0%98%D0%BD%D1%84%D0%BE%D0%B3%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B0%D1%8F%20%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D1%8C.png "Инфогическая модель")

![Даталогическая модель](./png/go-loyalty-%D0%94%D0%B0%D1%82%D0%B0%D0%BB%D0%BE%D0%B3%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B0%D1%8F%20%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D1%8C.png "Даталогическая модель")

- поддерживаются HTTP-запросы/ответы со сжатием данных;
- номера заказов уникальны и никогда не повторяются;
- номер заказа может быть принят в обработку только один раз от одного пользователя;
- номер заказа может не иметь никакого начисления;
- вознаграждение начисляется и тратится в виртуальных баллах из расчёта 1 балл = 1 единица местной валюты.
